<!DOCTYPE html>
<html lang="en">

<head>
    <title>Phantasma Contract Tester</title>
    
    <!-- Stuff Needed for Clean Run -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" crossorigin="anonymous">
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js" crossorigin="anonymous"></script>
    
    <!-- PhantasmaLink Stuff -->
    <script src="https://cdn.jsdelivr.net/gh/phantasma-io/PhantasmaLink/Dapps/www/public/Shared/phantasma.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/phantasma-io/PhantasmaLink/Dapps/www/public/Shared/validator.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/phantasma-io/PhantasmaLink/Dapps/www/public/Shared/phantasma.css" rel="stylesheet">

</head>

<body>

    <!-- Script To Connect -->
    <script>
    
        let mydappName = 'Contract Tester';
        let requiredVersion = 2;
        let platform = 'phantasma';
        let providerHint = 'ecto';
        let link = new PhantasmaLink(mydappName); // here we instantiate a Phantasma Link connection

        function loginToPhantasma() {
	        link.login( function(success) {
		        if (success) {
			        console.log('Connected to account ' + link.account.address + ' via ' + link.wallet);
		        }
	        }, requiredVersion, platform, providerHint);
        };
        
        function sendTransaction(){
            const accountWallet = link.account.address;
            const contractAddress = document.getElementById("contractAddy").value;
            const minimumFee = '100000';
            const gasLimit = '900';
            const cName = document.getElementById("contractName").value;
            const mName = document.getElementById("methodName").value;
            const param = document.getElementById("inputParameters").value
            
            const sb = new ScriptBuilder();
            
            const script = sb
            .callContract('gas', 'AllowGas', [accountWallet, contractAddress, minimumFee, gasLimit])
            .callContract(cName, mName, [param])
            .callContract('gas', 'SpendGas', [accountWallet])
            .endScript();
            
            console.log(sb);
            
            link.sendTransaction('main', script, null;
            
        };
    
    </script>
    
    <div style="margin:auto; height: 225px; width: 400px; background: lightblue;">
        <br>
        
        <h1 style="margin:auto;text-align:center;">Phantasma Contract Tester</h1>
        
        <br>
        <br>
        
        <div style = "width:100px;height:45px;margin:auto;">
        <!-- Connect Button -->
            <div style="margin:auto;">
                <button type="button" class="btn btn-lg" onclick="loginToPhantasma()">Connect</button>
            </div>
        </div>
    </div>
    
    <br>
    
    <div style="margin:auto; height:500px; width:400px; background: lightgreen;">
        <br>
        <br>
        <div style="margin:auto; width:350px">
            <input type:"text" id="contractAddy" placeholder="Contract Address" style="width:350px;"></input>
            <br>
            <br>
            <input type:"text" id="contractName" placeholder="Contract Name" style="width:350px;"></input>
            <br>
            <br>
            <input type:"text" id="methodName" placeholder="Method Name" style="width:350px;"></input>
            <br>
            <br>
            <input type:"text" id="inputParameters" placeholder="Parameters (parmeter1, parameter2, etc...)" style="width:350px;"></input>
        </div>
        <br>
        <div style = "width:175px;height:45px;margin:auto;">
            <div style="margin:auto;">
                <button type="button" class="btn btn-lg" onclick="sendTransaction()">Send Transaction</button>
            </div>
        </div>
    </div>
    
    

</body>

</html>
